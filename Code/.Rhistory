scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Prevalence of treatment',
y = "Monte Carlo SE")
p27 <- ggplot() +
geom_line(aes(x = sizes, y = SE_size[1,,1], colour = "Bootstrap")) +
geom_point(aes(x = sizes, y = SE_size[1,,1], colour = "Bootstrap")) +
geom_line(aes(x = sizes, y = SE_size[2,,1], colour = "Sandwich")) +
geom_point(aes(x = sizes, y = SE_size[2,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Sample size',
y = "Monte Carlo SE")
figure7 <- ggarrange(p25 + rremove("ylab"),p26 + rremove("ylab"),p27 + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'none')
figure7 <- annotate_figure(figure7,top = text_grob("Full model",size = 14), left = text_grob("Monte Carlo SE",size = 10, rot =  90))
p28 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[5,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[5,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[6,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[6,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Monte Carlo SE")
p29 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[7,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[7,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[8,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[8,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Monte Carlo SE")
p30 <- ggplot() +
geom_line(aes(x = sizes, y = SE_size[3,,1], colour = "Bootstrap")) +
geom_point(aes(x = sizes, y = SE_size[3,,1], colour = "Bootstrap")) +
geom_line(aes(x = sizes, y = SE_size[4,,1], colour = "Sandwich")) +
geom_point(aes(x = sizes, y = SE_size[4,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Monte Carlo SE")
figure8 <- ggarrange(p28 + rremove("ylab"),p29 + rremove("ylab"),p30 + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'bottom')
figure8 <- annotate_figure(figure8,top = text_grob("Simple model",size = 14), left = text_grob("Monte Carlo SE",size = 10, rot =  90))
ggarrange(heights = c(4,4.9), figure7, figure8, nrow = 2, ncol = 1)
SE <- (coverage_ind*(1-coverage_ind))/1000
SE_size <- (coverage_ind_size*(1-coverage_ind_size))/1000
p25 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[1,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[1,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[2,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[2,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Monte Carlo SE")
p26 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[3,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[3,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[4,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[4,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Prevalence of treatment',
y = "Monte Carlo SE")
p27 <- ggplot() +
geom_line(aes(x = sizes, y = SE_size[1,,1], colour = "Bootstrap")) +
geom_point(aes(x = sizes, y = SE_size[1,,1], colour = "Bootstrap")) +
geom_line(aes(x = sizes, y = SE_size[2,,1], colour = "Sandwich")) +
geom_point(aes(x = sizes, y = SE_size[2,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Sample size',
y = "Monte Carlo SE")
figure7 <- ggarrange(p25 + rremove("ylab"),p26 + rremove("ylab"),p27 + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'none')
figure7 <- annotate_figure(figure7,top = text_grob("Full model",size = 14), left = text_grob("Monte Carlo SE",size = 10, rot =  90))
p28 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[5,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[5,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[6,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[6,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Monte Carlo SE")
p29 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[7,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[7,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[8,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[8,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Prevalence of treatment',
y = "Monte Carlo SE")
p30 <- ggplot() +
geom_line(aes(x = sizes, y = SE_size[3,,1], colour = "Bootstrap")) +
geom_point(aes(x = sizes, y = SE_size[3,,1], colour = "Bootstrap")) +
geom_line(aes(x = sizes, y = SE_size[4,,1], colour = "Sandwich")) +
geom_point(aes(x = sizes, y = SE_size[4,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Sizes',
y = "Monte Carlo SE")
figure8 <- ggarrange(p28 + rremove("ylab"),p29 + rremove("ylab"),p30 + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'bottom')
figure8 <- annotate_figure(figure8,top = text_grob("Simple model",size = 14), left = text_grob("Monte Carlo SE",size = 10, rot =  90))
ggarrange(heights = c(4,4.9), figure7, figure8, nrow = 2, ncol = 1)
SE <- (coverage_ind*(1-coverage_ind))/1000
SE_size <- (coverage_ind_size*(1-coverage_ind_size))/1000
p25 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[1,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[1,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[2,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[2,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Monte Carlo SE")
p26 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[3,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[3,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[4,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[4,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Prevalence of treatment',
y = "Monte Carlo SE")
p27 <- ggplot() +
geom_line(aes(x = sizes*100, y = SE_size[1,,1], colour = "Bootstrap")) +
geom_point(aes(x = sizes*100, y = SE_size[1,,1], colour = "Bootstrap")) +
geom_line(aes(x = sizes*100, y = SE_size[2,,1], colour = "Sandwich")) +
geom_point(aes(x = sizes*100, y = SE_size[2,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Sample size',
y = "Monte Carlo SE")
figure7 <- ggarrange(p25 + rremove("ylab"),p26 + rremove("ylab"),p27 + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'none')
figure7 <- annotate_figure(figure7,top = text_grob("Full model",size = 14), left = text_grob("Monte Carlo SE",size = 10, rot =  90))
p28 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[5,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[5,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[6,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[6,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Monte Carlo SE")
p29 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[7,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[7,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[8,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[8,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Prevalence of treatment',
y = "Monte Carlo SE")
p30 <- ggplot() +
geom_line(aes(x = sizes*100, y = SE_size[3,,1], colour = "Bootstrap")) +
geom_point(aes(x = sizes*100, y = SE_size[3,,1], colour = "Bootstrap")) +
geom_line(aes(x = sizes*100, y = SE_size[4,,1], colour = "Sandwich")) +
geom_point(aes(x = sizes*100, y = SE_size[4,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Sizes',
y = "Monte Carlo SE")
figure8 <- ggarrange(p28 + rremove("ylab"),p29 + rremove("ylab"),p30 + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'bottom')
figure8 <- annotate_figure(figure8,top = text_grob("Simple model",size = 14), left = text_grob("Monte Carlo SE",size = 10, rot =  90))
ggarrange(heights = c(4,4.9), figure7, figure8, nrow = 2, ncol = 1)
p25 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[1,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[1,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[2,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[2,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Monte Carlo SE") +ylim(0,0.0003)
p26 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[3,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[3,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[4,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[4,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Prevalence of treatment',
y = "Monte Carlo SE")+ylim(0,0.0003)
p27 <- ggplot() +
geom_line(aes(x = sizes*100, y = SE_size[1,,1], colour = "Bootstrap")) +
geom_point(aes(x = sizes*100, y = SE_size[1,,1], colour = "Bootstrap")) +
geom_line(aes(x = sizes*100, y = SE_size[2,,1], colour = "Sandwich")) +
geom_point(aes(x = sizes*100, y = SE_size[2,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Sample size',
y = "Monte Carlo SE")+ylim(0,0.0003)
figure7 <- ggarrange(p25 + rremove("ylab"),p26 + rremove("ylab"),p27 + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'none')
figure7 <- annotate_figure(figure7,top = text_grob("Full model",size = 14), left = text_grob("Monte Carlo SE",size = 10, rot =  90))
p28 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[5,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[5,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[6,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[6,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Monte Carlo SE")+ylim(0,0.0003)
p29 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[7,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[7,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[8,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[8,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Prevalence of treatment',
y = "Monte Carlo SE")+ylim(0,0.0003)
p30 <- ggplot() +
geom_line(aes(x = sizes*100, y = SE_size[3,,1], colour = "Bootstrap")) +
geom_point(aes(x = sizes*100, y = SE_size[3,,1], colour = "Bootstrap")) +
geom_line(aes(x = sizes*100, y = SE_size[4,,1], colour = "Sandwich")) +
geom_point(aes(x = sizes*100, y = SE_size[4,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Sizes',
y = "Monte Carlo SE")+ylim(0,0.0003)
figure8 <- ggarrange(p28 + rremove("ylab"),p29 + rremove("ylab"),p30 + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'bottom')
figure8 <- annotate_figure(figure8,top = text_grob("Simple model",size = 14), left = text_grob("Monte Carlo SE",size = 10, rot =  90))
ggarrange(heights = c(4,4.9), figure7, figure8, nrow = 2, ncol = 1)
SE <- sqrt((coverage_ind*(1-coverage_ind))/1000)
SE_size <- sqrt((coverage_ind_size*(1-coverage_ind_size))/1000)
p25 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[1,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[1,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[2,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[2,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Monte Carlo SE")
p25
SE <- sqrt((coverage_ind*(1-coverage_ind))/1000)
SE_size <- sqrt((coverage_ind_size*(1-coverage_ind_size))/1000)
p25 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[1,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[1,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[2,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[2,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Monte Carlo SE")
p26 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[3,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[3,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[4,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[4,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Prevalence of treatment',
y = "Monte Carlo SE")+ylim(0,0.02)
p27 <- ggplot() +
geom_line(aes(x = sizes*100, y = SE_size[1,,1], colour = "Bootstrap")) +
geom_point(aes(x = sizes*100, y = SE_size[1,,1], colour = "Bootstrap")) +
geom_line(aes(x = sizes*100, y = SE_size[2,,1], colour = "Sandwich")) +
geom_point(aes(x = sizes*100, y = SE_size[2,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Sample size',
y = "Monte Carlo SE")+ylim(0,0.02)
figure7 <- ggarrange(p25 + rremove("ylab"),p26 + rremove("ylab"),p27 + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'none')
figure7 <- annotate_figure(figure7,top = text_grob("Full model",size = 14), left = text_grob("Monte Carlo SE",size = 10, rot =  90))
p28 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[5,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[5,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[6,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[6,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Monte Carlo SE")+ylim(0,0.02)
p29 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[7,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[7,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[8,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[8,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Prevalence of treatment',
y = "Monte Carlo SE")+ylim(0,0.02)
p30 <- ggplot() +
geom_line(aes(x = sizes*100, y = SE_size[3,,1], colour = "Bootstrap")) +
geom_point(aes(x = sizes*100, y = SE_size[3,,1], colour = "Bootstrap")) +
geom_line(aes(x = sizes*100, y = SE_size[4,,1], colour = "Sandwich")) +
geom_point(aes(x = sizes*100, y = SE_size[4,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Sizes',
y = "Monte Carlo SE")+ylim(0,0.02)
figure8 <- ggarrange(p28 + rremove("ylab"),p29 + rremove("ylab"),p30 + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'bottom')
figure8 <- annotate_figure(figure8,top = text_grob("Simple model",size = 14), left = text_grob("Monte Carlo SE",size = 10, rot =  90))
ggarrange(heights = c(4,4.9), figure7, figure8, nrow = 2, ncol = 1)
p25 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[1,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[1,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[2,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[2,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Monte Carlo SE") +ylim(0,0.02)
p26 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[3,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[3,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[4,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[4,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Prevalence of treatment',
y = "Monte Carlo SE")+ylim(0,0.02)
p27 <- ggplot() +
geom_line(aes(x = sizes*100, y = SE_size[1,,1], colour = "Bootstrap")) +
geom_point(aes(x = sizes*100, y = SE_size[1,,1], colour = "Bootstrap")) +
geom_line(aes(x = sizes*100, y = SE_size[2,,1], colour = "Sandwich")) +
geom_point(aes(x = sizes*100, y = SE_size[2,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Sample size',
y = "Monte Carlo SE")+ylim(0,0.02)
figure7 <- ggarrange(p25 + rremove("ylab"),p26 + rremove("ylab"),p27 + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'none')
figure7 <- annotate_figure(figure7,top = text_grob("Full model",size = 14), left = text_grob("Monte Carlo SE",size = 10, rot =  90))
p28 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[5,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[5,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[6,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[6,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Monte Carlo SE")+ylim(0,0.02)
p29 <- ggplot() +
geom_line(aes(x = 1:9/10, y = SE[7,,1], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = SE[7,,1], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = SE[8,,1], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = SE[8,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Prevalence of treatment',
y = "Monte Carlo SE")+ylim(0,0.02)
p30 <- ggplot() +
geom_line(aes(x = sizes*100, y = SE_size[3,,1], colour = "Bootstrap")) +
geom_point(aes(x = sizes*100, y = SE_size[3,,1], colour = "Bootstrap")) +
geom_line(aes(x = sizes*100, y = SE_size[4,,1], colour = "Sandwich")) +
geom_point(aes(x = sizes*100, y = SE_size[4,,1], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Sizes',
y = "Monte Carlo SE")+ylim(0,0.02)
figure8 <- ggarrange(p28 + rremove("ylab"),p29 + rremove("ylab"),p30 + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'bottom')
figure8 <- annotate_figure(figure8,top = text_grob("Simple model",size = 14), left = text_grob("Monte Carlo SE",size = 10, rot =  90))
ggarrange(heights = c(4,4.9), figure7, figure8, nrow = 2, ncol = 1)
coverage_ind
sd(coverage_ind[1,1,1])
coverage_ind[1,1,1]
sd(bootstrap_coefs[1,,1,1] - bootstrap_coefs[1,,1,2])
sd(bootstrap_coefs[1,,1,1] - bootstrap_coefs[1,,1,2])
sd(bootstrap_coefs[4,,1,1] - bootstrap_coefs[4,,1,2])
mean_lengths <- matrix(0, nrow = 8, ncol = 9)
for (i in 1:9){
mean_lengths[1,i] <- mean(rowMeans(bootstrap_coefs[,2,,i]- bootstrap_coefs[,1,,i], na.rm = TRUE))
mean_lengths[2,i] <- mean(rowMeans(sandwich_coefs[,2,,i]- sandwich_coefs[,1,,i], na.rm = TRUE))
mean_lengths[3,i] <- mean(rowMeans(bootstrap_treat[,2,,i]- bootstrap_treat[,1,,i], na.rm = TRUE))
mean_lengths[4,i] <- mean(rowMeans(sandwich_treat[,2,,i]- sandwich_treat[,1,,i], na.rm = TRUE))
mean_lengths[5,i] <- mean(rowMeans(bootstrap_coefs_noint[,2,,i]- bootstrap_coefs_noint[,1,,i], na.rm = TRUE))
mean_lengths[6,i] <- mean(rowMeans(sandwich_coefs_noint[,2,,i]- sandwich_coefs_noint[,1,,i], na.rm = TRUE))
mean_lengths[7,i] <- mean(rowMeans(bootstrap_treat_noint[,2,,i]- bootstrap_treat_noint[,1,,i], na.rm = TRUE))
mean_lengths[8,i] <- mean(rowMeans(sandwich_treat_noint[,2,,i]- sandwich_treat_noint[,1,,i], na.rm = TRUE))
}
sd_lengths <- matrix(0, nrow = 8, ncol = 9)
for (i in 1:9){
sd_lengths[1,i] <- sd(rowMeans(bootstrap_coefs[,2,,i]- bootstrap_coefs[,1,,i], na.rm = TRUE))
sd_lengths[2,i] <- sd(rowMeans(sandwich_coefs[,2,,i]- sandwich_coefs[,1,,i], na.rm = TRUE))
sd_lengths[3,i] <- sd(rowMeans(bootstrap_treat[,2,,i]- bootstrap_treat[,1,,i], na.rm = TRUE))
sd_lengths[4,i] <- sd(rowMeans(sandwich_treat[,2,,i]- sandwich_treat[,1,,i], na.rm = TRUE))
sd_lengths[5,i] <- sd(rowMeans(bootstrap_coefs_noint[,2,,i]- bootstrap_coefs_noint[,1,,i], na.rm = TRUE))
sd_lengths[6,i] <- sd(rowMeans(sandwich_coefs_noint[,2,,i]- sandwich_coefs_noint[,1,,i], na.rm = TRUE))
sd_lengths[7,i] <- sd(rowMeans(bootstrap_treat_noint[,2,,i]- bootstrap_treat_noint[,1,,i], na.rm = TRUE))
sd_lengths[8,i] <- sd(rowMeans(sandwich_treat_noint[,2,,i]- sandwich_treat_noint[,1,,i], na.rm = TRUE))
}
mean_lengths_size <- matrix(0,nrow = 4, ncol = 6)
for (i in 1:6){
mean_lengths_size[1,i] <- mean(rowMeans(bootstrap_size[,2,,i]- bootstrap_size[,1,,i], na.rm = TRUE))
mean_lengths_size[2,i] <- mean(rowMeans(sandwich_size[,2,,i]- sandwich_size[,1,,i], na.rm = TRUE))
mean_lengths_size[3,i] <- mean(rowMeans(bootstrap_size_noint[,2,,i]- bootstrap_size_noint[,1,,i], na.rm = TRUE))
mean_lengths_size[4,i] <- mean(rowMeans(sandwich_size_noint[,2,,i]- sandwich_size_noint[,1,,i], na.rm = TRUE))
}
sd_lengths_size <- matrix(0,nrow = 4, ncol = 6)
for (i in 1:6){
sd_lengths_size[1,i] <- sd(rowMeans(bootstrap_size[,2,,i]- bootstrap_size[,1,,i], na.rm = TRUE))
sd_lengths_size[2,i] <- sd(rowMeans(sandwich_size[,2,,i]- sandwich_size[,1,,i], na.rm = TRUE))
sd_lengths_size[3,i] <- sd(rowMeans(bootstrap_size_noint[,2,,i]- bootstrap_size_noint[,1,,i], na.rm = TRUE))
sd_lengths_size[4,i] <- sd(rowMeans(sandwich_size_noint[,2,,i]- sandwich_size_noint[,1,,i], na.rm = TRUE))
}
p1_sd <- ggplot() +
geom_line(aes(x = 1:9/10, y = sd_lengths[1,], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[1,], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = sd_lengths[2,], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[2,], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "CI length SE")
p2_sd <- ggplot() +
geom_line(aes(x = 1:9/10, y = sd_lengths[3,], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[3,], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = sd_lengths[4,], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[4,], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Prevalence of treatment',
y = "Mean CI length")
p3_sd <- ggplot() +
geom_line(aes(x = sizes*100, y = sd_lengths_size[1,], colour = "Bootstrap")) +
geom_point(aes(x = sizes*100, y = sd_lengths_size[1,], colour = "Bootstrap")) +
geom_line(aes(x = sizes*100, y = sd_lengths_size[2,], colour = "Sandwich")) +
geom_point(aes(x =sizes*100, y = sd_lengths_size[2,], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Sample size',
y = "Mean CI length")
figureA_sd <- ggarrange(p1_sd + rremove("ylab"),p2_sd + rremove("ylab"),p3_sd + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'none')
figureA_sd <- annotate_figure(figureA_sd,top = text_grob("Full model",size = 14), left = text_grob("CI length SE",size = 10, rot =  90))
p4_sd <- ggplot() +
geom_line(aes(x = 1:9/10, y = sd_lengths[5,], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[5,], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = sd_lengths[6,], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[6,], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Mean CI length")
p5_sd <- ggplot() +
geom_line(aes(x = 1:9/10, y = sd_lengths[7,], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[7,], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = sd_lengths[8,], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[8,], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Prevalence of treatment',
y = "Mean CI length")
p6_sd <- ggplot() +
geom_line(aes(x = sizes*100, y = sd_lengths_size[3,], colour = "Bootstrap")) +
geom_point(aes(x = sizes*100, y = sd_lengths_size[3,], colour = "Bootstrap")) +
geom_line(aes(x = sizes*100, y = sd_lengths_size[4,], colour = "Sandwich")) +
geom_point(aes(x =sizes*100, y = sd_lengths_size[4,], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Sample size',
y = "Mean CI length")
figureB_sd <- ggarrange(p4_sd + rremove("ylab"),p5_sd + rremove("ylab"),p6_sd + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'bottom')
figureB_sd <- annotate_figure(figureB_sd,top = text_grob("Simple model",size = 14), left = text_grob("CI length SE",size = 10, rot =  90))
ggarrange(heights = c(4, 4.9),figureA_sd, figureB_sd, nrow = 2, ncol = 1)
p1_sd <- ggplot() +
geom_line(aes(x = 1:9/10, y = sd_lengths[1,], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[1,], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = sd_lengths[2,], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[2,], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "CI length SE") +ylim(0,0.2)
p2_sd <- ggplot() +
geom_line(aes(x = 1:9/10, y = sd_lengths[3,], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[3,], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = sd_lengths[4,], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[4,], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Prevalence of treatment',
y = "Mean CI length") +ylim(0,0.2)
p3_sd <- ggplot() +
geom_line(aes(x = sizes*100, y = sd_lengths_size[1,], colour = "Bootstrap")) +
geom_point(aes(x = sizes*100, y = sd_lengths_size[1,], colour = "Bootstrap")) +
geom_line(aes(x = sizes*100, y = sd_lengths_size[2,], colour = "Sandwich")) +
geom_point(aes(x =sizes*100, y = sd_lengths_size[2,], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Sample size',
y = "Mean CI length")+ylim(0,0.2)
figureA_sd <- ggarrange(p1_sd + rremove("ylab"),p2_sd + rremove("ylab"),p3_sd + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'none')
figureA_sd <- annotate_figure(figureA_sd,top = text_grob("Full model",size = 14), left = text_grob("CI length SE",size = 10, rot =  90))
p4_sd <- ggplot() +
geom_line(aes(x = 1:9/10, y = sd_lengths[5,], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[5,], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = sd_lengths[6,], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[6,], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Confounding strength',
y = "Mean CI length")+ylim(0,0.2)
p5_sd <- ggplot() +
geom_line(aes(x = 1:9/10, y = sd_lengths[7,], colour = "Bootstrap")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[7,], colour = "Bootstrap")) +
geom_line(aes(x = 1:9/10, y = sd_lengths[8,], colour = "Sandwich")) +
geom_point(aes(x = 1:9/10, y = sd_lengths[8,], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Prevalence of treatment',
y = "Mean CI length")+ylim(0,0.2)
p6_sd <- ggplot() +
geom_line(aes(x = sizes*100, y = sd_lengths_size[3,], colour = "Bootstrap")) +
geom_point(aes(x = sizes*100, y = sd_lengths_size[3,], colour = "Bootstrap")) +
geom_line(aes(x = sizes*100, y = sd_lengths_size[4,], colour = "Sandwich")) +
geom_point(aes(x =sizes*100, y = sd_lengths_size[4,], colour = "Sandwich")) +
scale_color_manual(name = "CI type", values = c("Bootstrap"= "red", "Sandwich" = "blue")) +
labs(x = 'Sample size',
y = "Mean CI length")+ylim(0,0.2)
figureB_sd <- ggarrange(p4_sd + rremove("ylab"),p5_sd + rremove("ylab"),p6_sd + rremove("ylab"), nrow = 1, ncol = 3, common.legend = T, legend = 'bottom')
figureB_sd <- annotate_figure(figureB_sd,top = text_grob("Simple model",size = 14), left = text_grob("CI length SE",size = 10, rot =  90))
ggarrange(heights = c(4, 4.9),figureA_sd, figureB_sd, nrow = 2, ncol = 1)
View(DATA_GEN_censored)
data_path = "MSM_censor.csv"
PP_prep <- RandomisedTrialsEmulation::data_preparation(data_path, id='ID', period='t', treatment='A', outcome='Y', eligible ='eligible', cense = 'C',
model_switchd =c( 'X1', 'X2', 'X3', 'X4', 'age_s'),
cov_switchd = c( 'X1', 'X2', 'X3', 'X4', 'age_s'),
outcomeCov_var=c('X1', 'X2', 'X3', 'X4', 'age_s'), outcomeCov =c('X1', 'X2','X3', 'X4', 'age_s'), model_var = c('assigned_treatment'),
cov_censed = c( 'X1', 'X2','X3', 'X4', 'age_s'), model_censed =c( 'X1', 'X2','X3', 'X4', 'age_s'), pool_cense=1,
include_expansion_time_case = 0, include_followup_time_case = c("linear", "quadratic"), include_regime_length = 1,
use_weight=1, use_censor=1, data_dir =getwd(), numCores = 1, quiet = FALSE)
library(modelr)
library(reshape2)
library(tidyverse)
library(tidyr)
setwd("/Users/juliette/Documents/MPhil PHS 21-22/MPhil-dissertation/Code")
source("simulate_MSM.R")
set.seed(20222022)
simdata_censored<-DATA_GEN_censored(1000, 10, conf = 0.1)
write.csv(simdata_censored, file= "MSM_censor.csv", row.names = F)
library(RandomisedTrialsEmulation)
###################account for censoring##############################################
data_path = "MSM_censor.csv"
## simulate data for testing TrialEmulation package, using the algorithm in Young and Tchetgen Tchetgen (2014)
library(modelr)
library(reshape2)
library(tidyverse)
library(tidyr)
setwd("/Users/juliette/Documents/MPhil PHS 21-22/MPhil-dissertation/Code")
source("simulate_MSM.R")
set.seed(20222022)
#RUN ITT FILE FIRST TO ENSURE SIMULATED DATA ARE THE SAME
library(RandomisedTrialsEmulation)
###################account for censoring##############################################
data_path = "MSM_censor.csv"
##### excluding obs before first becoming eligible, with censoring by dropout #######################################
#### PP analysis
PP_prep <- RandomisedTrialsEmulation::data_preparation(data_path, id='ID', period='t', treatment='A', outcome='Y', eligible ='eligible', cense = 'C',
model_switchd =c( 'X1', 'X2', 'X3', 'X4', 'age_s'),
cov_switchd = c( 'X1', 'X2', 'X3', 'X4', 'age_s'),
outcomeCov_var=c('X1', 'X2', 'X3', 'X4', 'age_s'), outcomeCov =c('X1', 'X2','X3', 'X4', 'age_s'), model_var = c('assigned_treatment'),
cov_censed = c( 'X1', 'X2','X3', 'X4', 'age_s'), model_censed =c( 'X1', 'X2','X3', 'X4', 'age_s'), pool_cense=1,
include_expansion_time_case = 0, include_followup_time_case = c("linear", "quadratic"), include_regime_length = 1,
use_weight=1, use_censor=1, data_dir =getwd(), numCores = 1, quiet = FALSE)
